{
    "id": "83926c12-8ac2-45cc-bef3-25d2f433d145",
    "scriptName": "å‰ç«¯æ˜¾ç¤ºåŠŸèƒ½-æ•°æ®åº“ç‰ˆ",
    "findRegex": "/$/g",
    "replaceString": "\n======å½“å‰åœ°å›¾=======\n\n```html\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>æ¸¸æˆä¸–ç•Œæ•°æ®é¢æ¿</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link href=\"https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Kaiti&display=swap\" rel=\"stylesheet\">\n    <style>\n        :root {\n            --bg-main: #fdfaf5; /* ä»¿ç¾Šçš®çº¸èƒŒæ™¯è‰² */\n            --bg-container: rgba(245, 235, 220, 0.8); /* å®¹å™¨åŠé€æ˜èƒŒæ™¯ */\n            --text-main: #5a3e2b; /* ä¸»è¦æ–‡å­—é¢œè‰²ï¼Œæ·±æ£•è‰² */\n            --text-title: #3e271a; /* æ ‡é¢˜é¢œè‰²ï¼Œæ›´æ·±çš„æ£•è‰² */\n            --accent-color1: #8c6e54; /* ç‚¹ç¼€è‰²1ï¼Œç”¨äºæŒ‰é’®å’Œè¾¹æ¡† */\n            --accent-color2: #b48a5c; /* ç‚¹ç¼€è‰²2ï¼Œç”¨äºé«˜äº®å’Œäº¤äº’ */\n            --border-color: rgba(90, 62, 43, 0.3); /* è¾¹æ¡†é¢œè‰² */\n            --shadow-color: rgba(62, 39, 26, 0.2);\n            --font-title: 'Noto Serif SC', serif;\n            --font-main: 'Kaiti', 'Noto Serif SC', serif;\n            --radius-base: 8px;\n        }\n\n        body {\n            background-color: transparent;\n            margin: 0;\n            padding: 15px;\n            font-family: var(--font-main);\n            color: var(--text-main);\n            font-size: 17px; /* ç¨å¾®å¢å¤§åŸºç¡€å­—å· */\n            line-height: 1.6; /* æ”¹å–„è¡Œé—´è· */\n            background-image: url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAKAAoDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAT/xAAfEAACAQMFAQAAAAAAAAAAAAABAgMABBEhMQUSE0H/xAAUAQEAAAAAAAAAAAAAAAAAAAAF/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAMAwEAAhEDEQA/AJbGM2jlw2SOTbOQfowp4r24wLgYb6O2kLSyvIjdICQS7EAnHY1n6pQ//Z'); /* æ¨¡æ‹Ÿçº¸å¼ çº¹ç† */\n        }\n\n        .map-interface {\n            width: 100%;\n            margin: 0 auto;\n            background-color: var(--bg-main);\n            border: 1px solid var(--border-color); /* è¾¹æ¡†å˜ç»† */\n            border-radius: var(--radius-base);\n            padding: 20px;\n            box-sizing: border-box;\n            box-shadow: 0 4px 12px var(--shadow-color); /* é˜´å½±æ›´æŸ”å’Œ */\n            display: flex;\n            flex-direction: column;\n            gap: 10px; /* è¿›ä¸€æ­¥å‡å°ä¸»è¦æ¨¡å—é—´è· */\n        }\n\n        .top-bar {\n            display: flex;\n            justify-content: center; /* æ°´å¹³å±…ä¸­ */\n            text-align: center; /* æ–‡æœ¬å±…ä¸­ */\n            padding-bottom: 15px;\n            border-bottom: 1px solid var(--border-color);\n            flex-wrap: wrap;\n            gap: 10px;\n        }\n\n        .title-container h1 {\n            font-family: var(--font-title);\n            color: var(--text-title);\n            font-size: 2rem; /* å¢å¤§æ ‡é¢˜ */\n            margin: 0 0 5px 0; /* è°ƒæ•´å¤–è¾¹è· */\n            font-weight: 700;\n            text-shadow: 1px 1px 2px var(--shadow-color);\n        }\n        .current-time-container {\n            font-size: 0.95rem; /* åè°ƒå­—ä½“å¤§å° */\n            color: var(--text-main);\n            opacity: 0.9;\n            display: flex;\n            align-items: center;\n            justify-content: center; /* ç¡®ä¿å†…éƒ¨ä¹Ÿå±…ä¸­ */\n            gap: 8px;\n            white-space: nowrap;\n        }\n\n        /* ç§»é™¤æ—§çš„æŒ‰é’®å¯¼èˆªæ ï¼Œå› ä¸ºæŒ‰é’®å°†è¢«ç§»åˆ°æ–°çš„çŠ¶æ€æ ä¸­ */\n        .main-nav-buttons { display: none; }\n\n        /* --- æ–°å¢ï¼šä¸»è§’çŠ¶æ€æ  --- */\n        #protagonist-status-bar {\n            display: flex;\n            gap: 15px; /* å‡å°å¤´åƒå’Œä¿¡æ¯åŒºçš„é—´è· */\n            align-items: flex-start; /* é¡¶éƒ¨å¯¹é½ */\n            padding: 10px; /* å‡å°å†…è¾¹è· */\n            background: var(--bg-container);\n            border: 1px solid var(--border-color);\n            border-radius: var(--radius-base);\n            margin: 0; /* ç§»é™¤å¤–è¾¹è· */\n            box-shadow: 0 2px 8px var(--shadow-color);\n        }\n        .protagonist-portrait {\n            width: 80px; /* ç¼©å°å¤´åƒå°ºå¯¸ */\n            height: 80px;\n            border-radius: var(--radius-base);\n            border: 2px solid var(--accent-color1);\n            overflow: hidden;\n            flex-shrink: 0;\n            cursor: pointer;\n            position: relative;\n            background-color: #e0d5c8;\n            box-shadow: 0 2px 6px rgba(0,0,0,0.15); /* æ·»åŠ è½»å¾®é˜´å½± */\n        }\n        .protagonist-portrait img {\n            width: 100%;\n            height: 100%;\n            object-fit: cover;\n        }\n         /* å¤´åƒä¸Šä¼ æç¤º */\n        .portrait-upload-prompt {\n            position: absolute;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            background: rgba(0,0,0,0.6);\n            color: white;\n            text-align: center;\n            font-size: 12px;\n            padding: 4px 0;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n        .protagonist-portrait:hover .portrait-upload-prompt {\n            opacity: 1;\n        }\n        .protagonist-core-info {\n            flex-grow: 1;\n            display: flex;\n            flex-direction: row; /* æ°´å¹³æ’åˆ— */\n            justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */\n            align-items: center; /* æ”¹ä¸ºå‚ç›´å±…ä¸­ */\n            gap: 10px;\n        }\n        .protagonist-text-info {\n            display: flex;\n            flex-direction: column;\n            gap: 4px; /* æ–‡æœ¬ä¿¡æ¯å†…éƒ¨é—´è· */\n            align-items: flex-start; /* å·¦å¯¹é½ */\n        }\n        .protagonist-name-info {\n            display: flex;\n            flex-direction: column; /* å‚ç›´æ’åˆ—åå­—å’Œè¯¦æƒ… */\n            gap: 4px; /* åå­—å’Œè¯¦æƒ…çš„é—´è· */\n            align-items: flex-start; /* å·¦å¯¹é½ */\n        }\n        #protagonist-name {\n            font-family: var(--font-title);\n            font-size: 1.5rem; /* æ¢å¤ç¨å¤§çš„å­—å· */\n            color: var(--text-title);\n            font-weight: 700;\n            line-height: 1.2; /* è°ƒæ•´è¡Œé«˜ä½¿ä¹‹æ›´ç´§å‡‘ */\n        }\n        .protagonist-details {\n            display: flex;\n            flex-direction: column;\n            gap: 2px; /* è¡Œé—´è· */\n        }\n        .protagonist-details .detail-item {\n            font-size: 0.9rem;\n            opacity: 0.9;\n        }\n        .protagonist-money {\n            font-weight: bold;\n            color: var(--text-title);\n        }\n        .protagonist-main-controls {\n            display: flex;\n            gap: 8px; /* ç¼©å°æŒ‰é’®é—´è· */\n            flex-wrap: nowrap; /* ä¸æ¢è¡Œ */\n            align-items: center; /* å‚ç›´å±…ä¸­ */\n        }\n        .protagonist-stats-container {\n            flex-shrink: 0;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center;\n            min-width: 120px; /* è°ƒæ•´å®½åº¦ */\n            padding-left: 10px; /* å‡å°å·¦è¾¹è· */\n            border-left: 1px solid var(--border-color); /* æ·»åŠ åˆ†å‰²çº¿ */\n        }\n        \n        .function-btn {\n            background: var(--bg-container);\n            border: 1px solid var(--border-color);\n            color: var(--text-title);\n            padding: 12px 20px; /* å¢å¤§æŒ‰é’®å†…è¾¹è· */\n            border-radius: var(--radius-base);\n            font-size: 1.1rem; /* å¢å¤§å­—ä½“ */\n            cursor: pointer;\n            transition: all 0.2s ease-in-out; /* è°ƒæ•´è¿‡æ¸¡æ•ˆæœ */\n            font-family: var(--font-title);\n            box-shadow: 0 2px 5px var(--shadow-color);\n            text-shadow: 1px 1px 1px rgba(255,255,255,0.2); /* å¢åŠ æ–‡å­—è´¨æ„Ÿ */\n        }\n        .function-btn:hover {\n            background-color: var(--accent-color1);\n            color: var(--bg-main);\n            box-shadow: 0 4px 8px var(--shadow-color);\n            transform: translateY(-2px);\n        }\n        .function-btn i { margin-right: 8px; }\n\n        .horizontal-scroll-list .function-btn {\n            flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®åœ¨flexå®¹å™¨ä¸­è¢«å‹ç¼© */\n            white-space: nowrap; /* é˜²æ­¢æŒ‰é’®å†…æ–‡å­—æ¢è¡Œ */\n        }\n\n        /* --- ä¸»è§’çŠ¶æ€æ åœ†å½¢æŒ‰é’®æ ·å¼ --- */\n        .protagonist-main-controls .function-btn {\n            width: 44px; /* å›ºå®šå®½åº¦ */\n            height: 44px; /* å›ºå®šé«˜åº¦ */\n            border-radius: 50%; /* åœ†å½¢ */\n            padding: 0; /* ç§»é™¤å†…è¾¹è· */\n            font-size: 1.2rem; /* è°ƒæ•´å›¾æ ‡å¤§å° */\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-shrink: 0;\n        }\n        .protagonist-main-controls .function-btn span {\n            display: none; /* éšè—æ–‡å­— */\n        }\n        .protagonist-main-controls .function-btn i {\n            margin-right: 0; /* ç§»é™¤å›¾æ ‡çš„è¾¹è· */\n        }\n\n        .content-grid {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 10px;\n        }\n\n        .grid-item {\n            background: var(--bg-container);\n            border: 1px solid var(--border-color);\n            border-radius: var(--radius-base);\n            padding: 25px; /* å¢åŠ å†…è¾¹è· */\n            box-shadow: 0 2px 8px var(--shadow-color);\n            flex-grow: 1;\n            min-width: 300px;\n        }\n        \n        #protagonist-section { grid-column: 1 / -1; } /* ä¸»è§’éƒ¨åˆ†å æ»¡æ•´è¡Œ */\n\n        .section-title {\n            font-family: var(--font-title);\n            font-size: 1.4rem; /* å‡å°æ ‡é¢˜å­—å· */\n            color: var(--text-title);\n            margin-bottom: 15px;\n            padding-bottom: 10px;\n            border-bottom: 1px solid var(--border-color);\n            display: flex;\n            align-items: center;\n            font-weight: 700; /* åŠ ç²— */\n        }\n        .section-title i { \n            margin-right: 12px; \n            color: var(--accent-color1);\n            font-size: 1.1em; /* ç¨å¾®æ”¾å¤§å›¾æ ‡ */\n            vertical-align: -2px; /* è°ƒæ•´å›¾æ ‡å‚ç›´å¯¹é½ */\n        }\n        \n        /* Protagonist special UI */\n        .protagonist-layout { display: flex; gap: 20px; flex-wrap: wrap; }\n        .protagonist-info { flex: 2; min-width: 250px; }\n        .protagonist-stats { flex: 1; min-width: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center; }\n\n        .info-grid {\n            display: grid;\n            grid-template-columns: auto 1fr;\n            gap: 10px;\n            align-items: center;\n        }\n        .info-grid dt { font-weight: bold; color: var(--text-title); }\n        .info-grid dd { margin: 0; white-space: pre-wrap; }\n        \n        /* Key Characters List */\n        .character-card {\n            background: rgba(255, 255, 255, 0.5);\n            padding: 15px;\n            border-radius: var(--radius-base);\n            margin-bottom: 10px;\n            border-left: 5px solid var(--accent-color2);\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n        .character-card:hover { transform: translateX(5px); background: rgba(255,255,255,0.8); }\n        .character-header { display: flex; justify-content: space-between; align-items: center; }\n        .character-name { font-family: var(--font-title); font-size: 1.2rem; color: var(--text-title); }\n        .character-status { font-size: 0.9rem; font-style: italic; }\n\n        /* Generic List Style for Skills, Inventory, etc. */\n        .item-list { list-style: none; padding: 0; margin: 0; }\n        .list-item {\n            padding: 12px 0;\n            border-bottom: 1px dashed var(--border-color);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n        .list-item:last-child { border-bottom: none; }\n        .item-name { font-weight: bold; }\n        .item-details { font-size: 0.9rem; color: var(--text-main); }\n        \n        /* Quest Log Specific Styles */\n        #quest-items-container .list-item {\n            display: block;\n            padding: 0;\n            border-bottom: none;\n        }\n        #quest-items-container .list-item:last-child {\n            margin-bottom: 0;\n        }\n        .quest-item {\n            background-color: rgba(255, 255, 255, 0.4);\n            border: 1px solid var(--border-color);\n            border-left: 4px solid var(--accent-color2);\n            padding: 12px 15px;\n            margin-bottom: 10px;\n            border-radius: var(--radius-base);\n            transition: background-color 0.2s ease;\n        }\n        .quest-item:hover {\n            background-color: rgba(255, 255, 255, 0.7);\n        }\n        .quest-item .item-name {\n            font-family: var(--font-title);\n            font-size: 1.15rem;\n            margin-bottom: 8px;\n            color: var(--text-title);\n            font-weight: bold;\n        }\n        .quest-item .item-details {\n            font-size: 0.9rem;\n            margin-bottom: 4px;\n            padding-left: 5px;\n        }\n        .quest-item .item-details b {\n            color: var(--text-title);\n            margin-right: 5px;\n        }\n\n        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 1000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }\n        .modal-overlay.visible { opacity: 1; pointer-events: auto; }\n        .modal-dialog {\n            background: var(--bg-main);\n            border: 2px solid var(--accent-color1);\n            border-radius: var(--radius-base);\n            padding: 25px; /* è°ƒæ•´å†…è¾¹è· */\n            width: 90%;\n            max-width: 600px;\n            position: relative;\n            box-shadow: 0 5px 20px var(--shadow-color);\n            max-height: 85vh; /* é™åˆ¶æœ€å¤§é«˜åº¦ */\n            display: flex;\n            flex-direction: column;\n        }\n        .modal-dialog h4 { font-family: var(--font-title); font-size: 1.6rem; color: var(--text-title); text-align: center; margin-top: 0; margin-bottom: 20px; }\n        .close-modal-button { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 28px; color: var(--accent-color1); cursor: pointer; transition: color 0.2s ease; }\n        .close-modal-button:hover { color: var(--text-title); }\n        .modal-content {\n            overflow-y: auto; /* å†…å®¹æº¢å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */\n            flex-grow: 1;\n            padding-right: 15px;\n            word-wrap: break-word; /* å…è®¸é•¿å•è¯æˆ–URLæ¢è¡Œ */\n        }\n        .modal-content::-webkit-scrollbar { width: 6px; }\n        .modal-content::-webkit-scrollbar-track { background: var(--bg-container); }\n        .modal-content::-webkit-scrollbar-thumb { background: var(--accent-color1); border-radius: 3px; }\n\n        .interaction-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 10px;\n            margin-top: 20px;\n            padding-top: 20px;\n            border-top: 1px solid var(--border-color);\n        }\n        /* ä»…é’ˆå¯¹è§’è‰²å¼¹çª—ï¼Œå¼ºåˆ¶2x2ç½‘æ ¼ */\n        #character-modal .interaction-grid {\n            grid-template-columns: repeat(2, 1fr);\n        }\n        .interaction-grid .function-btn {\n            width: 100%;\n            padding: 12px 10px; /* è°ƒæ•´å†…è¾¹è· */\n        }\n\n        .list-item-content {\n            flex-grow: 1;\n            margin-right: 10px;\n        }\n        .use-button {\n            background: var(--accent-color2);\n            color: white;\n            border: none;\n            padding: 5px 12px;\n            border-radius: var(--radius-base);\n            cursor: pointer;\n            font-size: 0.9rem;\n            margin-left: 15px;\n            flex-shrink: 0;\n            transition: background-color 0.2s;\n        }\n        .use-button:hover {\n            background: var(--accent-color1);\n        }\n\n        .horizontal-scroll-list {\n            display: flex;\n            flex-wrap: nowrap;\n            gap: 12px; /* å¢åŠ æŒ‰é’®é—´è· */\n            overflow-x: auto;\n            padding: 5px 0 15px 0; /* è°ƒæ•´å†…è¾¹è· */\n            align-items: center;\n        }\n        .horizontal-scroll-list::-webkit-scrollbar { height: 6px; } /* åŠ ç²—æ»šåŠ¨æ¡ */\n        .horizontal-scroll-list::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }\n        .horizontal-scroll-list::-webkit-scrollbar-thumb { background: var(--accent-color1); border-radius: 2px; }\n\n        /* ç§»é™¤æ‰€æœ‰å®½å±æ ·å¼ */\n\n    @media (max-width: 768px) {\n        :root { --font-size-base: 12px; --spacing-md: 10px; --spacing-lg: 15px; }\n        body { padding: 5px; }\n        .map-interface { padding: var(--spacing-lg) var(--spacing-md); }\n        .partner-button-list { display: flex; flex-wrap: nowrap; overflow-x: auto; padding-bottom: 10px; -webkit-overflow-scrolling: touch; scrollbar-width: none; flex-shrink: 0; white-space: nowrap; }\n        .partner-button-list::-webkit-scrollbar { display: none; }\n        .partner-button { padding: 8px 14px; font-size: 0.9rem; flex-shrink: 0; white-space: nowrap; }\n        #important-character-buttons .partner-button { padding: 5px 10px 5px 5px; }\n        .sub-location-grid { grid-template-columns: 1fr; }\n        .modal-dialog { width: 95vw; padding: var(--spacing-lg) 15px; }\n        .modal-dialog h4 { font-size: 1.3rem; }\n        #modal-character-name { font-size: 1.7rem; }\n        .attributes-grid { grid-template-columns: repeat(2, 1fr); gap: var(--spacing-sm); }\n        .attribute-item { padding: var(--spacing-xs); }\n        .interaction-options-grid { grid-template-columns: 1fr; gap: var(--spacing-sm); }\n        .interaction-button, .sub-location-button { padding: 10px; font-size: 0.95rem; }\n        .shop-item, .inventory-item, .skill-item { flex-direction: column; align-items: center; gap: 10px; }\n        .shop-item > div, .inventory-item > div, .skill-item > div { text-align: center; }\n        .use-button { width: auto; padding-left: 40px; padding-right: 40px; }\n    }\n\n    @media (max-width: 480px) {\n        #protagonist-status-bar {\n            flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */\n            gap: 10px;\n            justify-content: center; /* å±…ä¸­å¤´åƒç­‰å…ƒç´  */\n        }\n\n        .protagonist-portrait {\n            width: 60px; /* è¿›ä¸€æ­¥ç¼©å°å¤´åƒ */\n            height: 60px;\n        }\n\n        .protagonist-stats-container {\n            padding-left: 0;\n            border-left: none; /* ç§»é™¤åˆ†å‰²çº¿ */\n            width: 100%; /* å æ»¡å¯ç”¨ç©ºé—´ä»¥å¸®åŠ©å±…ä¸­ */\n            justify-content: center; /* æ°´å¹³å±…ä¸­ */\n            align-items: center; /* å‚ç›´å±…ä¸­ */\n        }\n\n        .protagonist-core-info {\n            flex-direction: column; /* æ”¹ä¸ºå‚ç›´æ’åˆ— */\n            align-items: stretch; /* æ‹‰ä¼¸ä»¥å¡«å……å®½åº¦ */\n            gap: 12px;\n            width: 100%; /* å æ»¡æ•´è¡Œå®½åº¦ */\n        }\n\n        .protagonist-text-info {\n            align-items: center; /* å±…ä¸­å¯¹é½æ–‡æœ¬ */\n            text-align: center;\n            width: 100%;\n        }\n        .protagonist-name-info, #protagonist-name {\n                align-items: center; /* ç¡®ä¿åå­—ä¹Ÿå±…ä¸­ */\n        }\n        #protagonist-name {\n            font-size: 1.3rem; /* è°ƒæ•´åå­—å¤§å° */\n        }\n\n        .protagonist-main-controls {\n            order: -1; /* å°†æŒ‰é’®æåˆ°æœ€å‰é¢ */\n            justify-content: center; /* å±…ä¸­æŒ‰é’® */\n            width: 100%;\n        }\n    }\n    </style>\n</head>\n<body>\n    <div class=\"map-interface\">\n        <!-- é¡¶éƒ¨ä¿¡æ¯ä¸å¯¼èˆªæ  -->\n        <header class=\"top-bar\">\n            <div class=\"title-container\">\n                <h1 id=\"location-title\">åœ°ç‚¹åŠ è½½ä¸­...</h1>\n                <div id=\"current-time-container\" class=\"current-time-container\">\n                    <i class=\"fas fa-clock\"></i>\n                    <span id=\"current-time\">----</span>\n                </div>\n            </div>\n        </header>\n\n        <!-- æ–°å¢ï¼šä¸»è§’çŠ¶æ€æ  -->\n        <section id=\"protagonist-status-bar\">\n            <div id=\"protagonist-portrait-container\" class=\"protagonist-portrait\" title=\"ç‚¹å‡»ä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ\">\n                <img id=\"protagonist-portrait-img\" src=\"\" alt=\"ä¸»è§’å¤´åƒ\">\n                <div class=\"portrait-upload-prompt\">æ›´æ¢å¤´åƒ</div>\n            </div>\n            <div class=\"protagonist-core-info\">\n                <div class=\"protagonist-text-info\">\n                    <div class=\"protagonist-name-info\">\n                         <h2 id=\"protagonist-name\" style=\"margin: 0;\"></h2>\n                        <div id=\"protagonist-details\" class=\"protagonist-details\"></div>\n                    </div>\n                </div>\n                <div class=\"protagonist-main-controls\">\n                    <!-- è¯¦ç»†ä¿¡æ¯æŒ‰é’®å·²ç§»é™¤ï¼ŒåŠŸèƒ½æŒ‰é’®ä¿ç•™ -->\n                    <div class=\"function-btn\" id=\"skill-button\"><i class=\"fas fa-magic\"></i><span>æŠ€èƒ½</span></div>\n                    <div class=\"function-btn\" id=\"inventory-button\"><i class=\"fas fa-box-open\"></i><span>èƒŒåŒ…</span></div>\n                    <div class=\"function-btn\" id=\"quest-button\"><i class=\"fas fa-scroll\"></i><span>ä»»åŠ¡</span></div>\n                </div>\n            </div>\n        </section>\n\n        <!-- é‡è¦è§’è‰²æ  -->\n        <section id=\"key-characters-section\">\n            <div class=\"section-title\"><i class=\"fas fa-users\"></i>é‡è¦è§’è‰²ä¿¡æ¯</div>\n            <div id=\"character-bar\" class=\"horizontal-scroll-list\">\n                <!-- Character buttons will be inserted here by JS -->\n            </div>\n        </section>\n        \n        <!-- ä¸»è§’äº’åŠ¨é€‰é¡¹ -->\n        <section id=\"protagonist-interactions-section\">\n             <div class=\"section-title\"><i class=\"fas fa-tasks\"></i>å¯ç”¨è¡ŒåŠ¨</div>\n             <div id=\"protagonist-interactions-container\" class=\"interaction-grid\">\n                <!-- Protagonist interaction buttons will be inserted here by JS -->\n             </div>\n        </section>\n\n        <!-- ä¸»å†…å®¹åŒº -->\n        <main class=\"content-grid\" style=\"margin-top: 20px;\">\n            <!-- Future content can be added here -->\n        </main>\n    </div>\n\n    <!-- å¼¹çª— -->\n    <div id=\"character-modal\" class=\"modal-overlay\"><div class=\"modal-dialog\"><button class=\"close-modal-button\">&times;</button><h4 id=\"modal-character-name\"></h4><div id=\"modal-character-content\" class=\"modal-content\"></div><div id=\"modal-character-interactions\" class=\"interaction-grid\"></div></div></div>\n    <!-- å…¶ä»–å¼¹çª— (æŠ€èƒ½ã€èƒŒåŒ…ç­‰) -->\n    <div id=\"skill-modal\" class=\"modal-overlay\"><div class=\"modal-dialog\"><button class=\"close-modal-button\">&times;</button><h4><i class=\"fas fa-magic\"></i> æŠ€èƒ½åˆ—è¡¨</h4><div id=\"skill-items-container\" class=\"modal-content\"></div></div></div>\n    <div id=\"inventory-modal\" class=\"modal-overlay\"><div class=\"modal-dialog\"><button class=\"close-modal-button\">&times;</button><h4><i class=\"fas fa-box-open\"></i> èƒŒåŒ…</h4><div id=\"inventory-items-container\" class=\"modal-content\"></div></div></div>\n    <div id=\"quest-modal\" class=\"modal-overlay\"><div class=\"modal-dialog\"><button class=\"close-modal-button\">&times;</button><h4><i class=\"fas fa-scroll\"></i> ä»»åŠ¡æ—¥å¿—</h4><div id=\"quest-items-container\" class=\"modal-content\"></div></div></div>\n    <div id=\"shop-modal\" class=\"modal-overlay\"><div class=\"modal-dialog\"><button class=\"close-modal-button\">&times;</button><h4><i class=\"fas fa-store\"></i> å•†åº—</h4><div id=\"shop-items-container\" class=\"modal-content\"></div></div></div>\n\n    <script>\n        document.addEventListener('DOMContentLoaded', function() {\n            // Use live data source from parent, or a fallback that returns nothing.\n            const dataSourceAPI = (typeof parent !== 'undefined' && parent.AutoCardUpdaterAPI) ? parent.AutoCardUpdaterAPI : {\n                exportTableAsJson: function() {\n                    console.log(\"No data source found.\");\n                    return {}; // Return empty object if no source\n                },\n                registerTableUpdateCallback: function(callback) {\n                    console.log(\"No data source found to register callback.\");\n                }\n            };\n\n            function getTableData() {\n                try {\n                    return dataSourceAPI.exportTableAsJson();\n                } catch (e) {\n                    console.error(\"Error getting table data:\", e);\n                    return {};\n                }\n            }\n\n            function processJsonData(json) {\n                const tables = {};\n                if (!json || typeof json !== 'object') {\n                    console.error(\"Invalid JSON data provided.\");\n                    return null;\n                }\n                for (const sheetId in json) {\n                    if (Object.prototype.hasOwnProperty.call(json, sheetId) && json[sheetId] && json[sheetId].name) {\n                        const sheet = json[sheetId];\n                        tables[sheet.name] = {\n                            headers: sheet.content[0] || [],\n                            rows: sheet.content.slice(1)\n                        };\n                    }\n                }\n                return tables;\n            }\n\n            function renderUI(tables) {\n                if (!tables) return;\n                \n                // --- 1. æ¸²æŸ“å…¨å±€æ•°æ® ---\n                const globalTable = tables[\"å…¨å±€æ•°æ®è¡¨\"];\n                const globalData = globalTable?.rows[0] || [];\n                const globalHeaders = globalTable?.headers || [];\n                \n                document.getElementById('location-title').textContent = globalData[globalHeaders.indexOf(\"ä¸»è§’å½“å‰æ‰€åœ¨åœ°ç‚¹\")] || 'æœªçŸ¥åœ°ç‚¹';\n                document.getElementById('current-time').textContent = `å½“å‰æ—¶é—´ï¼š${globalData[globalHeaders.indexOf(\"å½“å‰æ—¶é—´\")] || '----'}`;\n\n                // --- 2. æ¸²æŸ“ä¸»è§’çŠ¶æ€æ  ---\n                const pInfoTable = tables[\"ä¸»è§’ä¿¡æ¯\"];\n                const pInfoHeaders = pInfoTable?.headers || [];\n                const pInfo = pInfoTable?.rows[0] || [];\n\n                // æ€»æ˜¯å°è¯•åŠ è½½å¤´åƒ\n                const charactersTable = tables[\"é‡è¦äººç‰©è¡¨\"];\n                let protagonistAvatarUrl = '';\n                if (pInfo.length > 0) {\n                    const protagonistName = pInfo[pInfoHeaders.indexOf(\"äººç‰©åç§°\")];\n                    if (charactersTable && charactersTable.rows) {\n                        const protagonistEntry = charactersTable.rows.find(row => row[charactersTable.headers.indexOf('å§“å')] === protagonistName);\n                        if (protagonistEntry) {\n                            protagonistAvatarUrl = protagonistEntry[charactersTable.headers.indexOf('å¤´åƒ')] || '';\n                        }\n                    }\n                }\n                loadProtagonistAvatar(protagonistAvatarUrl, 'ä¸»è§’');\n\n                if (pInfo.length > 0) {\n                    // åŸºæœ¬ä¿¡æ¯\n                    document.getElementById('protagonist-name').textContent = pInfo[pInfoHeaders.indexOf(\"äººç‰©åç§°\")] || 'ä¸»è§’';\n                    const detailsContainer = document.getElementById('protagonist-details');\n                    detailsContainer.innerHTML = `\n                        <div class=\"detail-item\">${pInfo[pInfoHeaders.indexOf(\"æ€§åˆ«/å¹´é¾„\")] || 'æœªçŸ¥'}</div>\n                        <div class=\"detail-item\">${pInfo[pInfoHeaders.indexOf(\"èŒä¸š/èº«ä»½\")] || 'æœªçŸ¥'}</div>\n                    `;\n                    \n                    // æ¸²æŸ“ä¸»è§’äº’åŠ¨é€‰é¡¹\n                    const interactionsContainer = document.getElementById('protagonist-interactions-container');\n                    interactionsContainer.innerHTML = '';\n                    const interactionHeaders = [\"é€‰é¡¹ä¸€\", \"é€‰é¡¹äºŒ\", \"é€‰é¡¹ä¸‰\", \"é€‰é¡¹å››\"];\n                    interactionHeaders.forEach(header => {\n                        const actionText = pInfo[pInfoHeaders.indexOf(header)];\n                        if(actionText) {\n                            const btn = document.createElement('button');\n                            btn.className = 'function-btn';\n                            btn.textContent = actionText;\n                            btn.onclick = () => sendGameActionRequest(actionText);\n                            interactionsContainer.appendChild(btn);\n                        }\n                    });\n                }\n                \n                // --- 3. æ¸²æŸ“é‡è¦äººç‰©æŒ‰é’® (åŒ…æ‹¬ä¸»è§’) ---\n                const characterBar = document.getElementById('character-bar');\n                characterBar.innerHTML = '';\n\n                // é¦–å…ˆæ·»åŠ ä¸»è§’æŒ‰é’®\n                if (pInfo.length > 0) {\n                     const pBtn = document.createElement('button');\n                     pBtn.className = 'function-btn';\n                     pBtn.innerHTML = `<i class=\"fas fa-user-circle\"></i> ${pInfo[pInfoHeaders.indexOf(\"äººç‰©åç§°\")] || 'ä¸»è§’'}`;\n                     pBtn.onclick = () => openCharacterModal({\n                         isProtagonist: true,\n                         info: pInfo, infoHeaders: pInfoHeaders\n                     });\n                     characterBar.appendChild(pBtn);\n                }\n\n                const characters = tables[\"é‡è¦äººç‰©è¡¨\"]?.rows || [];\n                const charHeaders = tables[\"é‡è¦äººç‰©è¡¨\"]?.headers || [];\n                const protagonistName = pInfo[pInfoHeaders.indexOf(\"äººç‰©åç§°\")];\n                characters.forEach(charData => {\n                    const charName = charData[charHeaders.indexOf('å§“å')];\n                    // è¿‡æ»¤æ‰ä¸»è§’æœ¬äººï¼Œå› ä¸ºå·²åœ¨ä¸Šé¢ç‹¬ç«‹æ·»åŠ \n                    if (charName && charName !== protagonistName) {\n                        const isDeparted = charData[charHeaders.indexOf('æ˜¯å¦ç¦»åœº')] === 'æ˜¯';\n                        const charBtn = document.createElement('button');\n                        charBtn.className = 'function-btn';\n                        charBtn.innerHTML = `<i class=\"fas fa-id-badge\"></i> ${charName}`;\n                        charBtn.onclick = () => openCharacterModal({ info: charData, infoHeaders: charHeaders });\n                        if (isDeparted) {\n                            charBtn.style.display = 'none';\n                        }\n                        characterBar.appendChild(charBtn);\n                    }\n                });\n\n                // --- 4. è®¾ç½®å¼¹çª—å†…å®¹ ---\n                setupModalContent('skill-modal', 'skill-items-container', tables[\"ä¸»è§’æŠ€èƒ½è¡¨\"], (item, headers) => {\n                    const listItem = document.createElement('li');\n                    listItem.className = 'list-item';\n                    \n                    const content = document.createElement('div');\n                    content.className = 'list-item-content';\n                    const skillName = item[headers.indexOf('æŠ€èƒ½åç§°')];\n                    content.innerHTML = `\n                        <div class=\"item-name\">${skillName} <small>[${item[headers.indexOf('ç­‰çº§/é˜¶æ®µ')]}]</small></div>\n                        <div class=\"item-details\">${item[headers.indexOf('æ•ˆæœæè¿°')]}</div>\n                    `;\n\n                    const useButton = document.createElement('button');\n                    useButton.className = 'use-button';\n                    useButton.textContent = 'ä½¿ç”¨';\n                    useButton.onclick = () => sendGameActionRequest(`ä½¿ç”¨æŠ€èƒ½ ${skillName}`);\n                    \n                    listItem.appendChild(content);\n                    listItem.appendChild(useButton);\n                    return listItem;\n                });\n                setupModalContent('inventory-modal', 'inventory-items-container', tables[\"èƒŒåŒ…ç‰©å“è¡¨\"], (item, headers) => {\n                    const listItem = document.createElement('li');\n                    listItem.className = 'list-item';\n\n                    const content = document.createElement('div');\n                    content.className = 'list-item-content';\n                    const itemName = item[headers.indexOf('ç‰©å“åç§°')];\n                    content.innerHTML = `\n                        <div class=\"item-name\">${itemName} (x${item[headers.indexOf('æ•°é‡')]})</div>\n                        <div class=\"item-details\">${item[headers.indexOf('æè¿°/æ•ˆæœ')]}</div>\n                    `;\n\n                    const useButton = document.createElement('button');\n                    useButton.className = 'use-button';\n                    useButton.textContent = 'ä½¿ç”¨';\n                    useButton.onclick = () => sendGameActionRequest(`ä½¿ç”¨ç‰©å“ ${itemName}`);\n\n                    listItem.appendChild(content);\n                    listItem.appendChild(useButton);\n                    return listItem;\n                });\n                setupModalContent('quest-modal', 'quest-items-container', tables[\"ä»»åŠ¡ä¸äº‹ä»¶è¡¨\"], (item, headers) => {\n                    const listItem = document.createElement('li');\n                    listItem.className = 'list-item';\n                    listItem.innerHTML = `\n                        <div class=\"quest-item\">\n                            <div class=\"item-name\">${item[headers.indexOf('ä»»åŠ¡åç§°')]} <small>[${item[headers.indexOf('ä»»åŠ¡ç±»å‹')]}]</small></div>\n                            <div class=\"item-details\"><b>å‘å¸ƒè€…:</b> ${item[headers.indexOf('å‘å¸ƒè€…')]}</div>\n                            <div class=\"item-details\"><b>æè¿°:</b> ${item[headers.indexOf('è¯¦ç»†æè¿°')]}</div>\n                            <div class=\"item-details\"><b>è¿›åº¦:</b> ${item[headers.indexOf('å½“å‰è¿›åº¦')]}</div>\n                        </div>\n                    `;\n                    return listItem;\n                });\n            }\n\n            /**\n             * å½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼Œåº”ç”¨ä¸€ä¸ªå¤‡ç”¨UIï¼ˆå½©è‰²èƒŒæ™¯åŠ é—®å·ï¼‰ã€‚\n             * @param {HTMLElement} element - å›¾ç‰‡çš„å®¹å™¨å…ƒç´ ã€‚\n             */\n            function applyImageFallback(element) {\n                if (!element) return;\n                const colors = ['#5a5a5a', '#6a4c4c', '#4c6a4c', '#4c4c6a', '#6a6a4c', '#4c6a6a'];\n                const randomColor = colors[Math.floor(Math.random() * colors.length)];\n                \n                element.innerHTML = ''; // æ¸…é™¤æŸåçš„imgæ ‡ç­¾\n                element.style.backgroundImage = 'none';\n                element.style.backgroundColor = randomColor;\n                element.style.display = 'flex';\n                element.style.justifyContent = 'center';\n                element.style.alignItems = 'center';\n                element.style.color = '#fff';\n                const size = Math.min(element.offsetWidth, element.offsetHeight);\n                element.style.fontSize = `${size * 0.6}px`;\n                element.style.fontWeight = 'bold';\n                element.style.lineHeight = '1';\n                element.textContent = '?';\n            }\n\n            /**\n             * ä»å¤šä¸ªæ¥æºåŠ è½½ä¸»è§’å¤´åƒï¼Œå¹¶æä¾›å¼ºå¤§çš„å›é€€æœºåˆ¶ã€‚\n             * @param {string} avatarUrlFromData - ä»æ•°æ®æºè·å–çš„å¤´åƒURLã€‚\n             * @param {string} protagonistName - ä¸»è§’åå­—ï¼Œç”¨äºlocalStorageçš„é”®ã€‚\n             */\n            function loadProtagonistAvatar(avatarUrlFromData, protagonistName) {\n                const container = document.getElementById('protagonist-portrait-container');\n                const imgElement = document.getElementById('protagonist-portrait-img');\n                const customAvatarKey = 'protagonist-custom-avatar-ä¸»è§’';\n                const customAvatar = localStorage.getItem(customAvatarKey);\n                const defaultAvatar = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ‘¤%3C/text%3E%3C/svg%3E\";\n\n                // æ¸…ç†æ—§çš„UIå…ƒç´ ï¼ˆå¦‚å›¾æ ‡å’Œé‡ç½®æŒ‰é’®ï¼‰\n                const existingResetBtn = container.querySelector('.avatar-reset-btn');\n                if (existingResetBtn) existingResetBtn.remove();\n                \n                // ç¡®ä¿å›¾ç‰‡å’Œå®¹å™¨æ¢å¤æ­£å¸¸æ ·å¼\n                imgElement.style.display = 'block';\n                container.style.backgroundColor = '#e0d5c8';\n                // å¦‚æœå®¹å™¨é‡Œæœ‰æ–‡å­—ï¼ˆæ¯”å¦‚fallbackçš„é—®å·ï¼‰ï¼Œå…ˆæ¸…ç©º\n                if(container.textContent) container.textContent = '';\n                // ç¡®ä¿å›¾ç‰‡å…ƒç´ åœ¨å®¹å™¨é‡Œ\n                if(!container.contains(imgElement)) container.appendChild(imgElement);\n\n\n\n                const sources = [];\n                if (customAvatar) sources.push(customAvatar);\n                if (avatarUrlFromData && (avatarUrlFromData.startsWith('http') || avatarUrlFromData.startsWith('data:'))) {\n                    sources.push(avatarUrlFromData);\n                }\n                sources.push(defaultAvatar);\n\n                let sourceIndex = 0;\n                const tryNextSource = () => {\n                    if (sourceIndex >= sources.length) {\n                        applyImageFallback(container);\n                        return;\n                    }\n                    imgElement.src = sources[sourceIndex];\n                    sourceIndex++;\n                };\n\n                imgElement.onerror = tryNextSource;\n                tryNextSource();\n            }\n\n            document.getElementById('protagonist-portrait-container').addEventListener('click', () => {\n                const customAvatarKey = 'protagonist-custom-avatar-ä¸»è§’';\n\n                const input = document.createElement('input');\n                input.type = 'file';\n                input.accept = \"image/*\";\n                input.onchange = (event) => {\n                    const file = event.target.files[0];\n                    if (!file) return;\n\n                    const reader = new FileReader();\n                    reader.onload = (e) => {\n                        const img = new Image();\n                        img.onload = () => {\n                            const canvas = document.createElement('canvas');\n                            const ctx = canvas.getContext('2d');\n                            const TARGET_SIZE = 300;\n                            canvas.width = TARGET_SIZE;\n                            canvas.height = TARGET_SIZE;\n                            \n                            // è£å‰ªä¸ºæ­£æ–¹å½¢\n                            const size = Math.min(img.width, img.height);\n                            const x = (img.width - size) / 2;\n                            const y = (img.height - size) / 2;\n                            \n                            ctx.drawImage(img, x, y, size, size, 0, 0, TARGET_SIZE, TARGET_SIZE);\n\n                            const dataUrl = canvas.toDataURL('image/png');\n\n                            try {\n                                localStorage.setItem(customAvatarKey, dataUrl);\n                                const imgElement = document.getElementById('protagonist-portrait-img');\n                                imgElement.src = dataUrl;\n                            } catch (err) {\n                                console.error(\"ä¿å­˜è‡ªå®šä¹‰å¤´åƒå¤±è´¥:\", err);\n                                alert('å›¾ç‰‡å¤ªå¤§æˆ–æµè§ˆå™¨ç¼“å­˜å·²æ»¡ï¼Œæ— æ³•ä¿å­˜ã€‚è¯·å°è¯•æ¸…ç†æµè§ˆå™¨ç¼“å­˜æˆ–ä½¿ç”¨æ›´å°çš„å›¾ç‰‡ã€‚');\n                            }\n                        };\n                        img.src = e.target.result;\n                    };\n                    reader.readAsDataURL(file);\n                };\n                input.click();\n            });\n            \n            function openModal(modalId) { document.getElementById(modalId).classList.add('visible'); }\n            function closeModal(modalId) { document.getElementById(modalId).classList.remove('visible'); }\n\n            function openCharacterModal(character) {\n                const modal = document.getElementById('character-modal');\n                const nameEl = document.getElementById('modal-character-name');\n                const contentContainer = document.getElementById('modal-character-content');\n                const interactionsContainer = document.getElementById('modal-character-interactions');\n                \n                contentContainer.innerHTML = '';\n                interactionsContainer.innerHTML = '';\n                nameEl.textContent = character.isProtagonist ? (character.info[character.infoHeaders.indexOf(\"äººç‰©åç§°\")] || 'ä¸»è§’') : (character.info[character.infoHeaders.indexOf('å§“å')] || 'æœªçŸ¥è§’è‰²');\n\n                const descFragment = document.createDocumentFragment();\n\n                if (character.isProtagonist) {\n                     const details = [\n                        { label: 'æ€§åˆ«/å¹´é¾„', value: character.info[character.infoHeaders.indexOf(\"æ€§åˆ«/å¹´é¾„\")] }, \n                        { label: 'å¤–è²Œ', value: character.info[character.infoHeaders.indexOf(\"å¤–è²Œç‰¹å¾\")] }, \n                        { label: 'èŒä¸š', value: character.info[character.infoHeaders.indexOf(\"èŒä¸š/èº«ä»½\")] }, \n                        { label: 'ç»å†', value: character.info[character.infoHeaders.indexOf(\"è¿‡å¾€ç»å†\")] },\n                        { label: 'æ€§æ ¼', value: character.info[character.infoHeaders.indexOf(\"æ€§æ ¼ç‰¹ç‚¹\")] },\n                    ];\n                    details.forEach(detail => {\n                        if (detail.value) {\n                            const p = document.createElement('p');\n                            p.innerHTML = `<strong>${detail.label}:</strong> ${detail.value}`;\n                            descFragment.appendChild(p);\n                        }\n                    });\n\n                } else {\n                    const details = [\n                        { label: 'æ€§åˆ«/å¹´é¾„', value: character.info[character.infoHeaders.indexOf('æ€§åˆ«/å¹´é¾„')] }, \n                        { label: 'å¤–è²Œ', value: character.info[character.infoHeaders.indexOf('å¤–è²Œç‰¹å¾')] }, \n                        { label: 'æ€§æ ¼', value: character.info[character.infoHeaders.indexOf('æ€§æ ¼ç‰¹ç‚¹')] }, \n                        { label: 'æŒæœ‰ç‰©å“', value: character.info[character.infoHeaders.indexOf('æŒæœ‰çš„é‡è¦ç‰©å“')] }, \n                        { label: 'å¥½æ„Ÿåº¦', value: character.info[character.infoHeaders.indexOf('å¥½æ„Ÿåº¦')] }, \n                        { label: 'ç»å†', value: character.info[character.infoHeaders.indexOf('è¿‡å¾€ç»å†')] },\n                    ];\n                    details.forEach(detail => {\n                        if (detail.value) {\n                            const p = document.createElement('p');\n                            p.innerHTML = `<strong>${detail.label}:</strong> ${detail.value}`;\n                            descFragment.appendChild(p);\n                        }\n                    });\n                }\n                \n                contentContainer.appendChild(descFragment);\n                interactionsContainer.innerHTML = ''; //ä¸å†éœ€è¦æ˜¾ç¤ºæš‚æ— äº’åŠ¨é€‰é¡¹äº†\n                openModal('character-modal');\n            }\n            \n            function setupModalContent(modalId, containerId, tableData, createItemElement) {\n                const container = document.getElementById(containerId);\n                container.innerHTML = '';\n                if (!tableData || !tableData.rows || tableData.rows.length === 0) {\n                    container.innerHTML = '<p style=\"text-align:center;\">æš‚æ— å†…å®¹</p>';\n                    return;\n                }\n                const list = document.createElement('ul');\n                list.className = 'item-list';\n                tableData.rows.forEach(row => {\n                    const listItem = createItemElement(row, tableData.headers);\n                    list.appendChild(listItem);\n                });\n                container.appendChild(list);\n            }\n\n            function sendGameActionRequest(msg) {\n                console.log(\"Action sent:\", msg);\n                if (typeof parent.triggerSlash === 'function') {\n                    try {\n                        parent.triggerSlash('/setinput ' + msg);\n                    } catch(e) {\n                        alert(e.toString());\n                    }\n                } else {\n                    const input = parent.document.getElementById('send_textarea');\n                    if (input) {\n                        input.value = msg;\n                    } else {\n                        alert('é”™è¯¯: æ— æ³•æ‰¾åˆ°è¾“å…¥æ¡†ã€‚');\n                    }\n                }\n            }\n            \n            // Initial Load\n            const initialData = getTableData();\n            const tables = processJsonData(initialData);\n            renderUI(tables);\n            \n            // Register update callback\n            dataSourceAPI.registerTableUpdateCallback(function(newData) {\n                console.log(\"Received data update, refreshing UI...\");\n                const updatedTables = processJsonData(newData);\n                renderUI(updatedTables);\n            });\n\n            // Bind button events\n            document.getElementById('skill-button').onclick = () => openModal('skill-modal');\n            document.getElementById('inventory-button').onclick = () => openModal('inventory-modal');\n            document.getElementById('quest-button').onclick = () => openModal('quest-modal');\n            // document.getElementById('shop-button').onclick = () => openModal('shop-modal');\n\n            // Re-bind close for protagonist/character modal specifically, as it might be recreated\n            const charModal = document.getElementById('character-modal');\n            if(charModal){\n                charModal.querySelector('.close-modal-button').onclick = () => closeModal('character-modal');\n            }\n\n\n            // Bind close buttons for all modals\n            document.querySelectorAll('.modal-overlay').forEach(modal => {\n                modal.querySelector('.close-modal-button').onclick = () => modal.classList.remove('visible');\n                // Also close on overlay click\n                modal.addEventListener('click', function(event) {\n                    if (event.target === this) {\n                        this.classList.remove('visible');\n                    }\n                });\n            });\n        });\n    </script>\n</body>\n</html>\n\n```\n",
    "trimStrings": [],
    "placement": [
        2
    ],
    "disabled": false,
    "markdownOnly": true,
    "promptOnly": false,
    "runOnEdit": true,
    "substituteRegex": 0,
    "minDepth": null,
    "maxDepth": 2
}